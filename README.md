Boa parte do código vem do normal, exceto pelas escolhas a mais, que apenas adicionam alguns "ifs" a mais no código.
